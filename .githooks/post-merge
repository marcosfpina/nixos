#!/usr/bin/env bash
# Post-merge hook: Update dependencies after merge
# Installed via: git config core.hooksPath .githooks

echo "ðŸ”„ Post-merge checks..."

# Check if flake.lock changed
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD | grep -q "flake.lock"; then
  echo "  â†’ flake.lock changed, consider updating dependencies"
  echo "ðŸ’¡ Run: nix flake update"
fi

# Check if modules changed
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD | grep -q "^modules/"; then
  echo "  â†’ Modules changed, consider rebuilding"
  echo "ðŸ’¡ Run: sudo nixos-rebuild switch"
fi

# Check if secrets config changed
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD | grep -q ".sops.yaml\|secrets/"; then
  echo "  â†’ Secrets configuration changed"
  echo "ðŸ’¡ Check: sops updatekeys secrets/*.yaml"
fi

echo "âœ… Post-merge checks complete"
