#!/usr/bin/env bash
# Commit message hook: Validate commit message format
# Installed via: git config core.hooksPath .githooks

set -e

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Skip merge commits
if grep -q "^Merge" "$commit_msg_file"; then
  exit 0
fi

# Skip if message already has Claude Code signature (from Claude)
if grep -q "Generated with \[Claude Code\]" "$commit_msg_file"; then
  exit 0
fi

# Check minimum length
if [[ ${#commit_msg} -lt 10 ]]; then
  echo "‚ùå Commit message too short (minimum 10 characters)"
  echo "Current: ${#commit_msg} characters"
  exit 1
fi

# Check for imperative mood (first word should be verb)
first_word=$(echo "$commit_msg" | head -1 | awk '{print $1}')
if [[ ! "$first_word" =~ ^(Add|Fix|Update|Remove|Refactor|Document|Test|Improve|Change|Create|Delete|Move|Rename|Merge|Revert).*$ ]]; then
  echo "‚ö†Ô∏è  Commit message should start with imperative verb"
  echo "   Examples: Add, Fix, Update, Remove, Refactor"
  echo "   Current: $first_word"
  # Warning only
fi

# Encourage linking to issues
if ! echo "$commit_msg" | grep -q "#[0-9]"; then
  echo "üí° Consider linking to an issue: Fixes #123 or Relates to #456"
  # Info only
fi

echo "‚úÖ Commit message validated"
