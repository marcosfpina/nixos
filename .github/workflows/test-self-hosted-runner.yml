name: Test Self-Hosted Runner

on:
  push:
    branches: [ main ]
  workflow_dispatch: # Permite executar manualmente

jobs:
  test-runner:
    runs-on: [self-hosted, nixos]

    steps:
      - name: Clean workspace
        run: |
          # Remove any leftover files from previous runs
          rm -rf ./* .git 2>/dev/null || true

      - name: Disable Git LFS globally
        run: |
          git config --global --unset filter.lfs.clean || true
          git config --global --unset filter.lfs.smudge || true
          git config --global --unset filter.lfs.process || true
          git config --global --unset filter.lfs.required || true
          echo "âœ… Git LFS filters disabled"

      - name: Checkout code
        uses: actions/checkout@v4
        with:
          lfs: false
          fetch-depth: 0
          clean: true
      
      - name: System Information
        run: |
          echo "ğŸ‰ Self-Hosted Runner is working!"
          echo ""
          echo "ğŸ“‹ System Info:"
          uname -a
          echo ""
          echo "ğŸ  Hostname:"
          hostname
          echo ""
          echo "ğŸ‘¤ User:"
          whoami
          echo ""
          echo "ğŸ“ Working Directory:"
          pwd
          echo ""
          echo "ğŸ’¾ Disk Space:"
          df -h / | tail -1
          echo ""
          echo "ğŸ§  Memory:"
          free -h | grep Mem
      
      - name: Test Nix
        run: |
          echo "ğŸ”§ Testing Nix installation..."
          nix --version
          echo ""
          echo "âœ… Nix is working!"
      
      - name: Test Git
        run: |
          echo "ğŸ”§ Testing Git..."
          git --version
          echo "Git branch: $(git branch --show-current)"
          echo ""
          echo "âœ… Git is working!"
      
      - name: Test Available Tools
        run: |
          echo "ğŸ› ï¸ Available tools:"
          echo "- curl: $(curl --version | head -1)"
          echo "- jq: $(jq --version)"
          echo "- bash: $BASH_VERSION"
          echo ""
          echo "âœ… All tools available!"
      
      - name: Success Report
        run: |
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘                                        â•‘"
          echo "â•‘   âœ… SELF-HOSTED RUNNER IS WORKING!   â•‘"
          echo "â•‘                                        â•‘"
          echo "â•‘   Runner: nixos-self-hosted            â•‘"
          echo "â•‘   Status: Online and operational       â•‘"
          echo "â•‘   Host: $(hostname)                    â•‘"
          echo "â•‘                                        â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"